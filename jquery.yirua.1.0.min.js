//  https://github.com/yicheng-irun/yirua
/*
    yirua.js
    @author Yicheng <yicheng-me@qq.com>
    @license MIT
    @version 1.0
*/(function(g){function n(b){b=b.children();for(var c=[],a,d=0;d<b.length;d++)a=b.eq(d),void 0!=a.attr("ys-model")?c.push(b.eq(d)):c=c.concat(n(a));return c}function k(b,c){if(!b.attr("ys-model-id")){for(var a=(new Date).getTime()+""+(10*Math.random()).toFixed(0);h[a];)a=(new Date).getTime()+""+(10*Math.random()).toFixed(0);h[a]=!0;b.attr("ys-model-id",a+"");var d=a,f={type:null,varp:null,varc:null,parent:c,childidlist:[],yshtml:""},e;e=n(b);for(var g=0;g<e.length;g++)f.childidlist.push(k(e[g],f));f.yshtml=b.html();e=b.attr("ys-model");void 0!=e?(e=e.split(" "),e[1]&&"if"==e[0]?(f.type="if",f.varc=e[1]):e[2]&&"in"==e[1]&&(f.type="map",f.varc=e[0],f.varp=e[2])):f.type="text";h[d]=f;b.html("");if(c)return a}return h[b.attr("ys-model-id")]}function l(b,c,a){return b==c.varname?a?c:c.value:"object"==typeof c.value&&b in c.value?c.value[b]:c.parent?l(b,c.parent,a):null}function p(b,c){var a=g.trim(b).split("."),d,f;if(a.length&&(d=l(a[0],c,!1),null!=d)){for(f=a.shift();a.length;){if("_key"==a[0])return l(f,c,!0).varkey;if(!(a[0]in d))return"";d=d[a.shift()]}return d}return""}function q(b,c){var a="",d=b.yshtml.replace(r,function(a,b,d,e){return p(b,c)});if(-1!=d.indexOf("ys-model")){for(var d=g(document.createElement("div")).html(d),f=d.find("[ys-model]"),e=0;e<f.length;e++){var h=k(f.eq(e),b);f.eq(e).html(m(h,p(h.varp,c),c))}a+=d.html()}else a+=d;return a}function m(b,c,a){var d="";c={value:c,varname:b.varp,varkey:null,parent:a};if("map"==b.type)for(mi in a={value:null,varname:b.varc,varkey:null,parent:c},c.value)a.value=c.value[mi],a.varkey=mi,d+=q(b,a);else"text"==b.type&&(d+=q(b,c));return d}if(g){var h={};g.yirua={};g.yirua.VERSION="1.0";var r=/\{\{(.+?)\}\}/g;g.fn.render=function(b){for(var c,a=0;a<this.length;a++)c=k(this.eq(a),null),this.eq(a).html(m(c,b),null);return this};g.fn.renderAsString=function(b){for(var c,a=[],d=0;d<this.length;d++)c=k(this.eq(d),null),a.push(m(c,b),null);1==this.length&&(a=a[0]);return a}}else console.error("JQuery or Zepto is undefineded!")})(window.jQuery?window.jQuery:window.Zepto?window.Zepto:null);
