//  https://github.com/yicheng-irun/yirua
/*
    https://github.com/yicheng-irun/yirua
    yirua.js
    A mini and ease-to-use templating plugin for jQuery or Zepto
    @author Yicheng <yicheng-me@qq.com>
    @license MIT
    @version 1.1
*/(function(g){function n(c){c=c.children();for(var b=[],a,d=0;d<c.length;d++)a=c.eq(d),void 0!=a.attr("yr-model")?b.push(c.eq(d)):b=b.concat(n(a));return b}function l(c,b){if(!c.attr("yr-model-id")){for(var a=(new Date).getTime()+""+(10*Math.random()).toFixed(0);h[a];)a=(new Date).getTime()+""+(10*Math.random()).toFixed(0);h[a]=!0;c.attr("yr-model-id",a+"");var d=a,e={type:null,varp:null,varc:null,parent:b,childidlist:[],yshtml:""},f;f=n(c);for(var g=0;g<f.length;g++)e.childidlist.push(l(f[g],e));e.yshtml=c.html();f=c.attr("yr-model");void 0!=f?(f=f.split(" "),f[1]&&"if"==f[0]?(e.type="if",e.varc=f[1]):f[2]&&"in"==f[1]&&(e.type="map",e.varc=f[0],e.varp=f[2])):e.type="text";h[d]=e;c.html("");if(b)return a}return h[c.attr("yr-model-id")]}function k(c,b,a){return c==b.varname?a?b:b.value:"object"==typeof b.value&&c in b.value?b.value[c]:b.parent?k(c,b.parent,a):null}function p(c,b){var a=g.trim(c).split("."),d,e;if(a.length&&(d=k(a[0],b,!1),null!=d)){for(e=a.shift();a.length;){if("_key"==a[0])return k(e,b,!0).varkey;if(!(a[0]in d))return"";d=d[a.shift()]}return d}return""}function q(c,b){var a="",d=null,e=c.yshtml.replace(r,function(a,c,d,e){return p(c,b)});-1!=e.indexOf("yr-src")&&(d=g(document.createElement("div")).html(e),d.find("[yr-src]").each(function(a,b){g(this).attr("src",g(this).attr("yr-src"))}));if(-1!=e.indexOf("yr-model")){null==d&&(d=g(document.createElement("div")).html(e));for(var f=d.find("[yr-model]"),h=0;h<f.length;h++){var k=l(f.eq(h),c);f.eq(h).html(m(k,p(k.varp,b),b))}}return a=null==d?a+e:a+d.html()}function m(c,b,a){var d="";b={value:b,varname:c.varp,varkey:null,parent:a};if("map"==c.type)for(mi in a={value:null,varname:c.varc,varkey:null,parent:b},b.value)a.value=b.value[mi],a.varkey=mi,d+=q(c,a);else"text"==c.type&&(d+=q(c,b));return d}if(g){var h={};g.yirua={};g.yirua.VERSION="1.1";var r=/\{\{(.+?)\}\}/g;g.fn.render=function(c){for(var b,a=0;a<this.length;a++)b=l(this.eq(a),null),this.eq(a).html(m(b,c),null);return this};g.fn.renderAsString=function(c){for(var b,a=[],d=0;d<this.length;d++)b=l(this.eq(d),null),a.push(m(b,c),null);1==this.length&&(a=a[0]);return a};g.fn.renderAppend=function(c){for(var b,a=0;a<this.length;a++)b=l(this.eq(a),null),this.eq(a).append(m(b,c),null);return this}}else console.error("JQuery or Zepto is undefineded!")})(window.jQuery?window.jQuery:window.Zepto?window.Zepto:null);